##
## Moved "workstation" tasks into separate playbook to avoid having a package install/upgrade affect
## a addtional ansible tasks (ie: it potentially breaks the next task execution)
##

- hosts: workstation
  tasks:

    - name: "TEMPLATE modify /etc/motd"
      template:
        src: motd.j2
        dest: /etc/motd
        owner: root
        group: root
        mode: 0644  
  
    - name: "YUM install atomic-openshift-{utils,clients} plus misc required packages"
      yum: 
        name=atomic-openshift-utils,atomic-openshift-clients,wget,git,net-tools,bind-utils,yum-utils,iptables-services,bridge-utils,bash-completion,kexec-tools,sos,psacct,nfs-utils,nfs4-acl-tools 
        state=installed

    - name: "TEMPLATE create /exports/helloworld/index.html"
      template:
        src: helloworld-html.j2
        dest: /exports/helloworld/index.html
        owner: root
        group: root
        mode: 0644

    - name: "SERVICE enable and start nfs"
      service:
        name=nfs
        state=started enabled=yes

    - name: "SERVICE enable and start nfslock"
      service:
        name=nfsLOCK
        state=started enabled=yes
      
    - name: "TEMPLATE modify/install /etc/exports"
      template:
        src: nfsexports.j2
        dest: /etc/exports
        owner: root
        group: root
        mode: 644
        
    - name "CMD export nfs filesystems
      shell: 
        cmd: |
          exportfs -a
